require("gui/WindowUtils")
require("GameUtils")
require("gui/SkillPagesSubWin")

local GameCoreHelper = CS.GameCoreHelper

--页面访问控件
local contentPane

local btnClose;
local ctlSkillPages;

local btnApply;
local btnReset;

local sceneMsgHandler;

local defRole;

--窗体初始化时
function onInit()
	contentPane = self.contentPane

	ctlSkillPages = SkillPagesSubWin:Create();
	ctlSkillPages:Init(contentPane:GetChild("skill_pages").asCom);

	local _roleID = self:GetWindowArgVal("role_id");
	if not IsEmptyOrNil(_roleID) then
		defRole = GameCoreHelper.GetRole(_roleID);
	end
	if defRole == nil then
		defRole = GameCoreHelper.GetPlayerRole();
	end

	ctlSkillPages:SetCurRole(defRole);

	--绑定按钮事件
	btnClose = contentPane:GetChild("btn_close").asButton;
	btnClose.onClick:Add(onClickBtnClose);

	self:SetBackkeyButton(btnClose)

	--btnApply= contentPane:GetChild("btn_apply").asButton;
	--btnApply.onClick:Add(onClickBtnApply);

	--btnReset= contentPane:GetChild("btn_reset").asButton;
	--btnReset.onClick:Add(onClickBtnReset);

	ctlSkillPages.onPageRefreshed = OnSkillPageUpdated;
	OnSkillPageUpdated();
end

--设置窗口参数
function SetWindowParams(args)

end

--窗体开始显示并播放显示动画时
function onDoShowAnimation()
	CommonShowWindowAnim(self, onShown)
end

--窗体播放完显示动画时
function onShown()
	sceneMsgHandler = CS.GUIHelper.RegSceneMsgHandler(OnSceneMsgHandler)
end

--窗体开始播放关闭动画时
function onDoHideAnimation()
	CommonHideWindowAnim(self, onHideAnimationDone)
end

function onHideAnimationDone()
	self:HideImmediately();
end

--窗体隐藏时
function onHide()
	CS.GUIHelper.HideCurMouseOverView();
	if sceneMsgHandler ~= nil then
		CS.GUIHelper.RemoveSceneMsgHandler(sceneMsgHandler)
	end

	CS.GUIHelper.CheckPlayerQuickSlotList();
end

function OnSceneMsgHandler(msgType, msgArg)
	if msgType == "close_map_ui" then
		onClickBtnClose();
	end
end

function onClickBtnClose()
	PlayButtonSound();

	self.CurDialogResult = -1;
	self:Hide();
end

function onClickBtnApply()
	PlayButtonSound();

	ctlSkillPages:ApplySkillDistribute();
	self.CurDialogResult = 0;
	self:Hide();
end

function onClickBtnReset()
	PlayButtonSound();

	ctlSkillPages:CancelSkillDistribute();
end

function OnSkillPageUpdated()
	if ctlSkillPages:IsChanged() then
		--btnApply.enabled = true;
		--btnReset.enabled = true;
	else
		--btnApply.enabled = false;
		--btnReset.enabled = false;
	end
end